pipeline {
    agent none // กำหนดว่า Pipeline โดยรวมยังไม่มี Agent เริ่มต้น

    stages {
        // อาจมี stage แรกๆ ที่รันบน Master ถ้าจำเป็น (เช่น ดึง Jenkinsfile)
        stage('Initialize') {
            agent any // หรือ agent { label 'master' } ถ้าต้องการให้รันบน Master ชัดเจน
            steps {
                echo 'Initializing environment on Jenkins Master...'
            }
        }

        stage('Checkout Source Code') {
            agent {
                label 'centos9-Linux' // <<< สำคัญมาก! กำหนดให้ขั้นตอนนี้รันบน Agent Linux ของคุณ
            }
            steps {
                // คำสั่ง git นี้จะถูกรันบนเครื่อง 'test-connect' ที่เป็น Linux
                git url: 'https://github.com/Stamp7ven/Maven-Projects.git'
                echo 'Source code checked out successfully on test-connect.'
            }
        }

        // เพิ่มขั้นตอนอื่นๆ เช่น Build, Test, Deploy โดยให้รันบน Agent 'test-connect'
        stage('Build Project') {
            agent { label 'test-connect' }
            steps {
                sh 'mvn clean install' // ตัวอย่างคำสั่ง Maven สำหรับ Linux
            }
        }
    }
    post {
        always {
            echo "Pipeline finished. Build status: ${currentBuild.result}"
        }
    }
}
